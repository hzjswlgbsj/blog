# æ¶è¡¥ JavaScript åŸºç¡€ä¹‹å˜é‡å¯¹è±¡

## å˜é‡å¯¹è±¡ï¼ˆVariable Objectï¼‰

> å˜é‡å¯¹è±¡æ˜¯ä¸æ‰§è¡Œä¸Šä¸‹æ–‡å…³è”çš„æ•°æ®å®¹å™¨ã€‚å®ƒæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å¯¹è±¡ï¼Œç”¨äºå­˜å‚¨åœ¨ä¸Šä¸‹æ–‡ä¸­å®šä¹‰çš„å˜é‡å’Œå‡½æ•°å£°æ˜ã€‚

æ³¨æ„ï¼š**å‡½æ•°è¡¨è¾¾å¼ï¼ˆä¸å‡½æ•°å£°æ˜ç›¸å¯¹ï¼‰ä¸ä¼šåœ¨å˜é‡å¯¹è±¡åˆ›å»ºé˜¶æ®µè¢«åŠ å…¥å…¶ä¸­**ã€‚

å˜é‡å¯¹è±¡æ˜¯ä¸€ä¸ªæ¯”è¾ƒæŠ½è±¡çš„æ¦‚å¿µã€‚åœ¨ä¸åŒçš„ä¸Šä¸‹æ–‡ç±»å‹ä¸­ï¼Œå˜é‡å¯¹è±¡çš„å…·ä½“è¡¨ç°å½¢å¼ä¹Ÿä¸åŒã€‚ä¾‹å¦‚ï¼š

- **åœ¨å…¨å±€ä¸Šä¸‹æ–‡ä¸­**ï¼Œå˜é‡å¯¹è±¡æ˜¯**å…¨å±€å¯¹è±¡æœ¬èº«**ï¼ˆå³ `window` æˆ– `globalThis`ï¼‰ã€‚
- **åœ¨å‡½æ•°ä¸Šä¸‹æ–‡ä¸­**ï¼Œå˜é‡å¯¹è±¡è¡¨ç°ä¸ºä¸€ä¸ªç‰¹æ®Šçš„ç»“æ„ï¼š**æ´»åŠ¨å¯¹è±¡ï¼ˆActivation Objectï¼‰**ã€‚

è¿™æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬èƒ½é€šè¿‡ `window.foo` æˆ– `this.foo` çš„æ–¹å¼è®¿é—®å…¨å±€å˜é‡çš„åŸå› ã€‚

æ¥çœ‹è¿™ä¸ªä¾‹å­ï¼š

```javascript
var foo = 10;

function bar() {} // ä¸€ä¸ªå‡½æ•°å£°æ˜
(function baz() {}); // ä¸€ä¸ªå‡½æ•°è¡¨è¾¾å¼

console.log(
  this.foo == foo, // true
  window.bar == bar // trueï¼ˆæµè§ˆå™¨ç¯å¢ƒï¼‰
);

console.log(baz); // ReferenceError: baz is not defined
```

### å…¨å±€ä¸Šä¸‹æ–‡çš„å˜é‡å¯¹è±¡ç»“æ„

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå…¨å±€ä¸Šä¸‹æ–‡çš„å˜é‡å¯¹è±¡ï¼ˆVOï¼‰å¦‚ä¸‹ï¼š

![](https://lib.sixtyden.com/20210321084752.png)

> å‡½æ•°è¡¨è¾¾å¼ `baz` ä¸ä¼šåœ¨å˜é‡å¯¹è±¡åˆå§‹åŒ–æ—¶åŠ å…¥å…¶ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬æ— æ³•åœ¨è¡¨è¾¾å¼å¤–éƒ¨è®¿é—®å®ƒã€‚

### å…³äºä½œç”¨åŸŸçš„è¡¥å……è¯´æ˜

ä¸å…¶ä»–è¯­è¨€ï¼ˆå¦‚ C / C++ï¼‰ä¸åŒï¼Œåœ¨ ECMAScript ä¸­**åªæœ‰å‡½æ•°ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ä½œç”¨åŸŸ**ï¼ˆåœ¨ ES5 ä¸­æ˜¯è¿™æ ·ï¼ŒES6 æ‰å¼•å…¥äº†å—çº§ä½œç”¨åŸŸ `let/const`ï¼‰ã€‚

åœ¨å‡½æ•°èŒƒå›´å†…å®šä¹‰çš„å˜é‡åœ¨å‡½æ•°ä½œç”¨åŸŸä¸­ï¼Œåœ¨å¤–éƒ¨ä¸å¯è§ï¼Œä¹Ÿä¸ä¼šæ±¡æŸ“å…¨å±€å˜é‡å¯¹è±¡ã€‚

æ­¤å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ `eval()` åŠ¨æ€åˆ›å»ºå˜é‡ï¼Œå®ƒå°†ä½¿ç”¨è°ƒç”¨å®ƒçš„ä¸Šä¸‹æ–‡çš„å˜é‡å¯¹è±¡ï¼ˆéä¸¥æ ¼æ¨¡å¼ï¼‰æˆ–å…¨å±€å˜é‡å¯¹è±¡ï¼ˆä¸¥æ ¼æ¨¡å¼ï¼‰ä½œä¸ºå®¿ä¸»ä¸Šä¸‹æ–‡ã€‚

## æ´»åŠ¨å¯¹è±¡ï¼ˆActivation Objectï¼‰

å½“ä¸€ä¸ªå‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªç§°ä¸º**æ´»åŠ¨å¯¹è±¡ï¼ˆAOï¼‰**çš„ç‰¹æ®Šç»“æ„ã€‚å®ƒæ˜¯å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­çš„å˜é‡å¯¹è±¡ï¼Œç”±ä»¥ä¸‹éƒ¨åˆ†ç»„æˆï¼š

- å‡½æ•°çš„å½¢å‚ï¼ˆparametersï¼‰
- ç‰¹æ®Šçš„ `arguments` å¯¹è±¡ï¼ˆä¸€ä¸ªæ˜ å°„å½¢å‚çš„ç±»æ•°ç»„å¯¹è±¡ï¼‰
- å‡½æ•°ä¸­å£°æ˜çš„å˜é‡ï¼ˆ`var`ï¼‰
- å‡½æ•°å£°æ˜ï¼ˆfunction declarationsï¼‰

æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š

```javascript
function foo(x, y) {
  var z = 30;
  function bar() {} // å‡½æ•°å£°æ˜
  (function baz() {}); // å‡½æ•°è¡¨è¾¾å¼
}

foo(10, 20);
```

è°ƒç”¨ `foo(10, 20)` æ—¶ï¼Œå®ƒçš„æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­ä¼šç”Ÿæˆå¦‚ä¸‹çš„æ´»åŠ¨å¯¹è±¡ï¼š

![](https://lib.sixtyden.com/20210321085901.png)

> åŒæ ·çš„ï¼Œå‡½æ•°è¡¨è¾¾å¼ `baz` ä¸åŒ…å«åœ¨å˜é‡å¯¹è±¡ä¸­ã€‚

## è¯æ³•ç¯å¢ƒæ¨¡å‹ï¼ˆLexical Environmentï¼‰

åœ¨ ES5 çš„è§„èŒƒå®ç°ä¸­ï¼Œå˜é‡å¯¹è±¡ï¼ˆVOï¼‰å’Œæ´»åŠ¨å¯¹è±¡ï¼ˆAOï¼‰çš„æ¦‚å¿µæœ€ç»ˆè¢«ç»Ÿä¸€ä¸º**è¯æ³•ç¯å¢ƒï¼ˆLexical Environmentï¼‰æ¨¡å‹**ã€‚è¿™ä¸ªæ¨¡å‹æ›´æ¸…æ™°åœ°æè¿°äº†ä½œç”¨åŸŸé“¾çš„æ„å»ºæ–¹å¼ï¼Œå»ºè®®å‚è€ƒ Dmitry Soshnikov çš„ç³»åˆ—æ–‡ç« äº†è§£æ›´å¤šç»†èŠ‚ã€‚

> ğŸ“˜ å‚è€ƒé“¾æ¥ï¼š[ES5 Lexical Environments - Dmitry Soshnikov](http://dmitrysoshnikov.com/ecmascript/es5-chapter-3-2-lexical-environments-ecmascript-implementation/)

## è¡¥å……ï¼šES6 ä¹‹åçš„è¡Œä¸ºå˜æ›´

ä» ES6 å¼€å§‹ï¼Œå¼•å…¥äº† `let`ã€`const` å’Œ `class`ï¼Œè¿™äº›å£°æ˜**ä¸å†åŠ å…¥å˜é‡å¯¹è±¡ï¼ˆVOï¼‰æˆ–æ´»åŠ¨å¯¹è±¡ï¼ˆAOï¼‰ä¸­**ï¼Œè€Œæ˜¯åŠ å…¥åˆ°äº†**è¯æ³•ç¯å¢ƒè®°å½•ï¼ˆLexical Environment Recordï¼‰**ä¸­ï¼Œå¹¶å­˜åœ¨**æš‚æ—¶æ€§æ­»åŒºï¼ˆTDZï¼‰**ã€‚

å› æ­¤ï¼Œ`let` å’Œ `const` å£°æ˜çš„å˜é‡å³ä½¿å‡ºç°åœ¨é¡¶éƒ¨ï¼Œä¹Ÿæ— æ³•æå‰è®¿é—®ï¼š

```javascript
console.log(a); // ReferenceError: Cannot access 'a' before initialization
let a = 1;
```

## å‚è€ƒèµ„æ–™

1. [MDN å®˜æ–¹å¯¹å˜é‡æå‡çš„æè¿°](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Grammar_and_Types#Variable_hoisting)
2. [å…³äºå˜é‡æå‡çš„è®¨è®º](https://stackoverflow.com/questions/31219420/are-variables-declared-with-let-or-const-not-hoisted-in-es6#)
3. [ç†è§£ JavaScript ä¸­çš„æ‰§è¡Œä¸Šä¸‹æ–‡å’Œæ‰§è¡Œæ ˆ](https://juejin.im/post/5ba32171f265da0ab719a6d7)
4. [æ·±å…¥äº†è§£ JavaScript çš„æ‰§è¡Œä¸Šä¸‹æ–‡](https://yanhaijing.com/javascript/2014/04/29/what-is-the-execution-context-in-javascript/)
5. [ç»´åŸºç™¾ç§‘ - ä½œç”¨åŸŸ](https://zh.wikipedia.org/wiki/ä½œç”¨åŸŸ)
6. [Dmitry Soshnikov ç³»åˆ—ï¼ˆFacebook çš„ ECMAScript ç†è®ºä¸“å®¶ï¼‰](http://dmitrysoshnikov.com/ecmascript/javascript-the-core/#execution-context-stack)

## ğŸ“š æ¶è¡¥ JavaScript åŸºç¡€ç³»åˆ—

ç³»åˆ—æ–‡ç« æ±‡æ€»åœ°å€ï¼š<https://www.sixtyden.com/archive>

æœ¬ç³»åˆ—æ˜¯æˆ‘ä»å­¦æ ¡æ¯•ä¸šå…¥å‘å‰ç«¯é˜¶æ®µçš„æ€»ç»“äº§ç‰©ï¼Œå‚è€ƒäº†å¤šæœ¬ç»å…¸ä¹¦ç±å’Œåšå®¢èµ„æ–™ï¼Œä»¥ä¸‹æ˜¯éƒ¨åˆ†æ¥æºï¼š

- [JavaScript é«˜çº§ç¨‹åºè®¾è®¡](https://book.douban.com/subject/10546125/)
- [ä½ ä¸çŸ¥é“çš„ JavaScriptï¼ˆä¸Šå·ï¼‰](https://book.douban.com/subject/26351021/)
- [é™ªä½ è¯»ä¹¦ï¼ˆJavaScript Web å‰ç«¯ï¼‰](https://www.ximalaya.com/jiaoyu/3740790/)
- [ç‹ç¦æœ‹çš„åšå®¢](https://www.cnblogs.com/wangfupeng1988/tag/javascript/)
- [å†´ç¾½çš„ JavaScript ç³»åˆ—](https://github.com/mqyqingfeng/Blog)
- [æ±¤å§†å¤§å”æ·±å…¥ JavaScript ç³»åˆ—](https://www.cnblogs.com/TomXu/archive/2011/12/15/2288411.html)
- [Dmitry Soshnikov ECMAScript è§£è¯»](http://dmitrysoshnikov.com/ecmascript/javascript-the-core/)

å¦‚æœ‰é”™æ¼æˆ–ä¸å½“ä¹‹å¤„ï¼Œæ¬¢è¿æŒ‡å‡ºï¼Œæ„Ÿæ¿€ä¸å°½ï¼Œæ„¿ä¸è¯¸å›å…±å‹‰ï¼

ï¼ˆå®Œï¼‰

# æ•°ç»„æ‰å¹³åŒ–

æ•°ç»„æ‰å¹³åŒ–ï¼ˆFlatteningï¼‰æ˜¯æŒ‡å°†ä¸€ä¸ªå¤šç»´æ•°ç»„è½¬æ¢ä¸ºä¸€ç»´æ•°ç»„çš„è¿‡ç¨‹ã€‚è¿™ä¸ªæ“ä½œåœ¨æ•°æ®å¤„ç†ã€å‰ç«¯å¼€å‘ã€å¤„ç†æ¥å£è¿”å›çš„æ•°æ®æ—¶éå¸¸å¸¸è§ï¼Œå°¤å…¶æ˜¯åµŒå¥—ç»“æ„çš„æ•°æ®æ ¼å¼ã€‚

## ä½¿ç”¨åœºæ™¯

- æ¥å£è¿”å›åµŒå¥—æ•°ç»„æ•°æ®ç»“æ„ï¼Œéœ€è¦æ•´ç†æˆä¸€ç»´æ–¹ä¾¿å±•ç¤ºã€‚
- å¤„ç†æ ‘ç»“æ„èŠ‚ç‚¹æ—¶å°†æ‰€æœ‰èŠ‚ç‚¹æ”¶é›†ä¸ºçº¿æ€§åˆ—è¡¨ã€‚
- React ç­‰æ¡†æ¶ä¸­æ¸²æŸ“å­å…ƒç´ ç»“æ„ã€‚
- æ•°æ®åˆ†æã€è¡¨æ ¼å¯¼å‡ºç­‰éœ€è¦çº¿æ€§åŒ–æ•°æ®å¤„ç†ã€‚

## å®ç°

### åŸç”Ÿ flat æ–¹æ³•ï¼ˆES2019+ï¼‰

ä» ECMAScript 2019ï¼ˆES10ï¼‰å¼€å§‹ï¼ŒJavaScript åŸç”Ÿå°±æ”¯æŒæ•°ç»„æ‰å¹³åŒ–æ“ä½œï¼š`Array.prototype.flat(depth)`ã€‚

```javascript
const arr = [1, [2, [3, [4, 5]]]];
arr.flat();        // é»˜è®¤ depth = 1 => [1, 2, [3, [4, 5]]]
arr.flat(2);       // => [1, 2, 3, [4, 5]]
arr.flat(Infinity); // => [1, 2, 3, 4, 5]
```

ç‰¹ç‚¹ï¼š

- è¯­æ³•ç®€æ´ã€‚
- æ€§èƒ½ä¼˜ç§€ï¼Œç”±å¼•æ“å†…éƒ¨ä¼˜åŒ–ã€‚
- é€‚ç”¨äºç°ä»£æµè§ˆå™¨æˆ–æ”¯æŒ ES2019 çš„ç¯å¢ƒã€‚
- æ”¯æŒè‡ªå®šä¹‰å±•å¼€æ·±åº¦ã€‚

> ğŸ’¡ æ³¨æ„ï¼šä¸å…¼å®¹æ—§ç‰ˆæœ¬æµè§ˆå™¨ï¼ˆå¦‚ IEï¼‰ï¼Œå¦‚éœ€å…¼å®¹å»ºè®®ä½¿ç”¨ polyfill æˆ– fallback æ–¹æ³•ã€‚

---

### é€’å½’å®ç°

æœ€ç»å…¸çš„æ–¹å¼ï¼Œé€šè¿‡é€’å½’ä¸æ–­å±•å¼€æ•°ç»„ä¸­çš„å…ƒç´ ã€‚

```javascript
export function flatten(arr) {
  const result = [];
  arr.forEach(item => {
    if (Array.isArray(item)) {
      result.push(...flatten(item));
    } else {
      result.push(item);
    }
  });
  return result;
}
```

ç‰¹ç‚¹ï¼š

- ç®€æ´æ˜“æ‡‚ã€‚
- æ”¯æŒä»»æ„æ·±åº¦ã€‚
- æ€§èƒ½é€‚ä¸­ï¼Œè°ƒç”¨æ ˆè¾ƒæ·±æ—¶éœ€æ³¨æ„é€’å½’æ ˆæº¢å‡ºé—®é¢˜ã€‚

---

### ä½¿ç”¨ reduce

```javascript
export function flatten(arr) {
  return arr.reduce((acc, val) => 
    Array.isArray(val) ? acc.concat(flatten(val)) : acc.concat(val), []
  );
}
```

ç‰¹ç‚¹ï¼š

- æ›´å‡½æ•°å¼çš„å†™æ³•ï¼Œé“¾å¼è°ƒç”¨é£æ ¼ã€‚
- æœ¬è´¨ä¸Šè¿˜æ˜¯é€’å½’ï¼Œä½†æ›´åå‘å‡½æ•°å¼æ€ç»´æ–¹å¼ã€‚

---

### ä½¿ç”¨æ ˆ

è¿™ç§æ–¹å¼ä¸ä½¿ç”¨é€’å½’ï¼Œè€Œæ˜¯æ‰‹åŠ¨ç»´æŠ¤ä¸€ä¸ªæ ˆç»“æ„ã€‚

```javascript
export function flatten(input) {
  const stack = [...input];
  const res = [];
  while (stack.length) {
    const next = stack.pop();
    if (Array.isArray(next)) {
      stack.push(...next);
    } else {
      res.push(next);
    }
  }
  return res.reverse();
}
```

ç‰¹ç‚¹ï¼š

- éé€’å½’ï¼Œé¿å…äº†é€’å½’è°ƒç”¨æ ˆæº¢å‡ºé—®é¢˜ã€‚
- æ§åˆ¶æµç¨‹æ›´æ˜¾å¼ã€‚
- æœ€ç»ˆç»“æœéœ€åè½¬é¡ºåºã€‚

---

### Underscore æºç é£æ ¼çš„å®ç°ï¼ˆé€’å½’ + å‚æ•°æ§åˆ¶ï¼‰

è¿™æ®µä»£ç æ”¹ç¼–è‡ª Underscore.js çš„æºç ï¼Œå®ç°äº†ä¸€ä¸ªéå¸¸çµæ´»çš„æ•°ç»„æ‰å¹³åŒ–å‡½æ•°ï¼š

```javascript
/**
 * æ•°ç»„æ‰å¹³åŒ–
 * @param  {Array} input   è¦å¤„ç†çš„æ•°ç»„
 * @param  {boolean} shallow æ˜¯å¦åªæ‰å¹³ä¸€å±‚
 * @param  {boolean} strict  æ˜¯å¦ä¸¥æ ¼å¤„ç†å…ƒç´ 
 * @param  {Array} output  ä¸ºäº†é€’å½’æ—¶å¤ç”¨ç»“æœæ•°ç»„
 */
export function flatten(input, shallow, strict, output) {
  output = output || [];
  var idx = output.length;

  for (var i = 0, len = input.length; i < len; i++) {
    var value = input[i];
    if (Array.isArray(value)) {
      if (shallow) {
        var j = 0, length = value.length;
        while (j < length) output[idx++] = value[j++];
      } else {
        flatten(value, shallow, strict, output);
        idx = output.length;
      }
    } else if (!strict) {
      output[idx++] = value;
    }
  }

  return output;
}
```

#### å‚æ•°è¯´æ˜

- `shallow`: æ˜¯å¦åªæ‰å¹³åŒ–ä¸€å±‚ã€‚
- `strict`: æ˜¯å¦â€œä¸¥æ ¼æ¨¡å¼â€ï¼Œå³æ˜¯å¦åªä¿ç•™æ•°ç»„ä¸­çš„æ•°ç»„å…ƒç´ ã€‚
  - å¦‚æœä¸º `true`ï¼Œåˆ™éæ•°ç»„çš„å…ƒç´ ä¼šè¢«å¿½ç•¥ã€‚
  - å¦‚æœä¸º `false`ï¼Œåˆ™æ‰€æœ‰éæ•°ç»„å…ƒç´ ä¹Ÿä¼šåŠ å…¥ç»“æœä¸­ã€‚
- `output`: ç”¨äºé€’å½’æ—¶ç´¯åŠ ç»“æœï¼Œå¤–éƒ¨è°ƒç”¨æ—¶å¯ä»¥ä¸ä¼ ã€‚

#### ä½¿ç”¨ç¤ºä¾‹

```javascript
flatten([1, [2, [3, 4]], 5], true, false); 
// => [1, 2, [3, 4], 5]

flatten([1, [2, [3, 4]], 5], false, false); 
// => [1, 2, 3, 4, 5]
```

ç‰¹ç‚¹ï¼š

- æ”¯æŒä¸€å±‚å±•å¼€å’Œå®Œå…¨å±•å¼€ä¸¤ç§æ¨¡å¼ã€‚
- å¯ä»¥é€šè¿‡ `strict` æ§åˆ¶æ˜¯å¦è·³è¿‡éæ•°ç»„å…ƒç´ ã€‚
- æ˜¯ Underscore åœ¨å®é™…ç”Ÿäº§ä¸­ä½¿ç”¨çš„æ‰å¹³åŒ–æ ¸å¿ƒå®ç°æ–¹å¼ã€‚

---

## å°ç»“

| æ–¹æ³•               | æ˜¯å¦é€’å½’ | ç‰¹ç‚¹                                  |
|-------------------|----------|--------------------------------------|
| åŸç”Ÿ flat æ–¹æ³•      | âŒ       | ç®€æ´é«˜æ•ˆï¼Œæ”¯æŒå±•å¼€æ·±åº¦ï¼ŒES2019+         |
| é€’å½’åŸºç¡€å†™æ³•        | âœ…       | æ˜“æ‡‚ã€ç®€æ´                            |
| reduce æ–¹å¼        | âœ…       | å‡½æ•°å¼å†™æ³•ã€ç®€æ´                       |
| æ ˆå®ç°             | âŒ       | éé€’å½’ã€æ§åˆ¶æ˜¾å¼ã€éœ€ reverse            |
| underscore å®ç°    | âœ…       | å‚æ•°ä¸°å¯Œã€çµæ´»ã€æ”¯æŒ shallow/strict     |
